---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# underground

**Updated on 2018-01-11 with data up to 2017-12-09**

London Underground performance data is published in
[spreadsheets](https://tfl.gov.uk/corporate/publications-and-reports/underground-services-performance).
This R package makes it available in [csv
files](https://github.com/nacnudus/underground/tree/master/inst/extdata), or in
an R data frame.

The secret sauce is [tidyxl](https://nacnudus.github.io/tidyxl) with a dash of
[unpivotr](https://nacnudus.github.io/unpivotr).

## Installation

```r
devtools::install_github("nacnudus/underground")
```

## Example

```{r}
library(underground)
library(dplyr)
library(ggplot2)

underground %>%
  filter(metric == "Train delays longer than 15 minutes",
         year == "2017/18",
         is.na(quarter),
         fourweek == 9,
         line != "All Lines") %>%
  mutate(fill= underground_colours[line]) %>%
  select(line, value, fill) %>%
  ggplot(aes(line, value, fill = fill)) +
  geom_bar(stat = "identity") +
  scale_fill_identity("", labels = underground_lines, guide = "legend") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  xlab("") +
  ylab("") +
  ggtitle("Train delays longer than 15 minutes",
          subtitle = "Period 9 2017/18 from 12 November 2017 to 9 December 2017")
```

## Four-weekly periods

Most series data are reported in periods approximately four weeks long.  Some
periods are shorter or longer by a day or more, so that each year is covered by
13 periods, beginning on the 1st of April.

Join the dataset `fourweeks` to resolve periods (1 to 13) to dates.

## Metrics

```{r}
distinct(underground, metric) %>%
  pull(metric)
```
